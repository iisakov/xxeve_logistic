# xxeve_logistic dev by iisakov
tg @iisakovArtisan

Это учебный проект. В нём была предпринята попытка сделать мониторинг рейса для межзвёзных перелётов в eve online.
## Основные требования к проекту:
- Создание собственного индекса безопасности.
- Мониторинг солнечных систем.
- Возможность проложить маршрут от точки А до точки Б и получить информацию о безопасности в точках маршрута.

## Источники данных:
- https://esi.evetech.net/ui/?version=latest#/Universe/get_universe_system_jumps - Основной источник, API самой игры
- https://zkillboard.com/ - основной источник, API партнёрского проекта по сбору и анализу killmail (Убойных писем).
- https://www.adam4eve.eu/ - Сайт с подробной информацией о мире eve online в таблицах и схемах (вдохнавлялся)
- https://evemaps.dotlan.net/ - Информация по навигации в eve online
- https://wiki.eveuniversity.org/Main_Page - Человекопонятная вики по eve online, пользовался для получения названий кораблей и основных торговых хабов в игре
- https://discord.com/channels/377698507630575617/377739695934799874 - сообщество игроков, подсказавшее большую часть из выше перечисленных ссылок (и не только)
- https://eve-gatecheck.space/eve/#Jita:Amarr:shortest - Ближайший аналог. Его плюсы: Считает битвы у ворот. Мои плюсы: Учитываю возмездие Конкорда, и покушения на транспорт.

## Используемые инструменты и технологии:
- python - основной язык - скрипты и mvp приложения
- SQLite - локальная база данных
- WSL - локальная виртуальная машина, с которой запускаются скрипты
- YandexCloud:
 - Yandex Compute Cloud - в разработке (удалённый доступ, cron)
 - Managed Service for PostgreSQL - Удалённая база данных для дашборда
 - Yandex DataLens - Представление данных
- GitHub - Cистема контроля версий, хранение кода.

## Каких целей удалось добиться, каким образом:
### Создание собственного индекса безопасности.
Для получения собственного индекса безопасности были использованы:
- Так называемые мной "снимки систем" они хранятся в таблице snap_statistic_systems. Можно получить по официальному API
- Статус безопасности системы, выставленный самой игрой. Можно получить по официальному API
- Информация о нападавшем(их) и жертвах. Также можно получить в официальном API ,но для этого нужно знать hash и id убойного письма. Эту информацию игроки МОГУТ ,но не обязаны предоставлять на сайте https://zkillboard.com/
- В будущем хотелось бы улучшить индекс информацией о том, была ли схвадка у звёзных врат или нет - Это позволит понять ловили нападающие ни в чём не повиннного путешественника или схватка была честной, и жертва попала в валгаллу.

Для получения индекса мы в первую очередь берём за основу официальный индекс безопасности системы, далее строим примерно такую формулу (100*Индекс системы - ([процент убийств от общего количества прыжков в системе в этот час] * [сумму возмездий Конкорда]) - ([процент убийств от общего количества прыжков в системе в этот час] * [сумму нападений на транспорт]) - [процент убийств от общего количества прыжков в системе в этот час]). Таким образом, мы можем высчитать наш индекс безопасности системы. А теперь, нам нужно понять, насколько он отклонился от официального уровня. Мы просто вычитаем из кастомного индекса официальный. Вел дан. Таким образом, мы можем добавлять множество парамметров, и они все будут зависить от процента убийств от активности в системе. Так, если в системе 3000 прыжком и только 2 убийства за этот час, мы получим слабое влияние на индекс, если же прыжков было 10, а килов всё так же 2, то такой параметр сильно повлияет на наш индекс и мы увидим довольно заметную разницу.

На дашборде эта метрика показана собственно нашим высчитанным индексом безопасности (синяя полоса) и разницей между кастом и офишиал индексами (красная полоса) - мы можем иметь представление о текущем индексе и его отклонении от официального.

### Мониторинг солнечных систем.
Мониторинг представлен вкладкой "системные показатели" - на которой представлены снимки систем. В данный момент, мы можем определить активность той или иной системы по часам, и составить представление в какой момент времени, лучше всего передвигаться сквозь эту систему. Настройки производятся по интервалу времени и по набору звёздных систем. Этой части задачи было уделено не так много времени, потенциал этой вкладки и данных, которые можно получить от источников, позволит добиться результатов приближенных к сайту https://www.adam4eve.eu/, а на его основе и превзойти его. Но цель данного проекта составить MVP приложения мониторинга. Кажется с этой задачей мы справились.
Единственная проблема, это полуавтоматическая настройка дашборда - сейчас он настроен на маршрут Jita - Amarr и для того, чтобы поменять его, придётся лезть в sql запросы каждого чарта, но для этого я добавил вначале и конце работы скрипта main получение списка маршрута, достаточно скопировать его из консоли и добавить в отведённое для него место в sql запросе. В дальнейшем этот косяк будет исправлен.


### Возможность проложить маршрут от точки А до точки Б и получить информацию о безопасности в точках маршрута.
В этом вопросе мы продвинулись меньше всего, наделов немало ошибок в начале и в середине пути.
На локальной виртуальной машине можно запустить main файл с параметрами:
- -r [Начало маршрута] [Конец маршрута] - Это позволяет получить кратчайший маршрут от точки А до точки Б а также получить 100 последних убойных писем на каждый пункт маршрута со всей информацией о нападающем, жертве - их корпорации и альянсе.
- -s Получить последние снимки систем на этот час - лучше всего вызывать в конце часа - тем самым получим полную картину активности в системе.
- -i параметр позволяет после окончания скрипта запустить его повторно на бесконечный цикл.

- Если main файл вызывается без параметров, он входит в режим сбора данных по всем маршрутам между основными торговыми хабами eve online и дополнительными + хабами в npc хабами в нулях. Если вы хотите добавить или убрать какую-то систему - придётся лезть в код и править список руками, но это не так сложно.

Так же минус данного MVP это пересоздание таблиц на удалённой машине вместо обновления данных в ней. Это ещё предстоит исправить. Это сильно тормозит работу с приложением, и вызывает, так сказать, кулдаун на дашборде. Через это обновление данных происходит после вызова main файла в любом из режимов. Я советую использовать -r Jita Perimeter - это соседние звёздные системы, и для ознакомления с сервисом отлично подходят.

Возможно, к моменту прочтения этого мануала я добавил возможность подключения к виртуальной машине на YandexCloud или даже что-то типа API к сервису, но ничего не обещаю, если вдруг этого не произошло, Обратитесь ко мне в tg оставленному в начале этого мануала.
